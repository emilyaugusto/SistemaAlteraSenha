<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Suporte â€“ Senha Recebida</title>
  <link rel="icon" href="imagens/Icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link href="StyleAdmin.css" rel="stylesheet">
</head>
<body>

<h1>Painel de Suporte â€“ Ãšltima Senha Recebida</h1>

<div class="senha-box">
  <div class="senha" id="mensagem">Aguardando mensagem...</div>
</div>
<br />
<div class="senha-box2">
  <input class="senha2" id="senhaInput" type="text" value="Carregando..." readonly />
</div>
<br />
<button onclick="copiarSenha()">Copiar Senha</button>
<br />

  <img src="/imagens/FeitalLogo.png" alt="Grupo Feital" />

  <script>
  let senhaAnterior = "";

  async function carregarDados() {
    try {
      const resposta = await fetch("/api/senha");
      const data = await resposta.json();

      const senha = data.senha || "Nenhuma informaÃ§Ã£o";

      // Verifica se a senha mudou
      if (senha !== senhaAnterior) {
        if (senhaAnterior !== "") {
          location.reload(); // ðŸ”„ Reload elegante apenas quando mudar
          return;
        }
        senhaAnterior = senha;
      }

      // Sempre seta como password
      const input = document.getElementById("senhaInput");
      input.type = "password";
      input.value = senha;

      document.getElementById("mensagem").innerText = "Senha recebida";

    } catch (err) {
      document.getElementById("mensagem").innerText = "Erro ao carregar dados";
      const input = document.getElementById("senhaInput");
      input.type = "text";
      input.value = "Erro";
    }
  }

  function copiarSenha() {
    const senha = document.getElementById("senhaInput").value;
    navigator.clipboard.writeText(senha).then(() => {
      alert("Senha copiada para a Ã¡rea de transferÃªncia.");
    });
  }

  carregarDados();
  setInterval(carregarDados, 5000);
</script>


</body>
</html>
